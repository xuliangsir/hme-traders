/** * Created by liangxu on 2017/11/16. */var config = require("../config/DB").config;var pg = require("pg");var Q = require("q");function DB_Base(){}DB_Base.prototype._connect = function(callback){    var connectStr = config.pg_connectStr;    var defer = Q.defer();    var pool = new pg.Pool(config);    pool.connect( (err, client, done)=> {        if(err){            defer.reject(err);        }else{            defer.resolve({client: client, done: done});        }    });    return defer.promise.nodeify(callback);};DB_Base._query = function(sql, params, callback){    if(typeof params == 'function'){        callback = params;        params = [];    }    if(!params){        params = [];    }    if(!sql){        var err = new Error("sql is empty!");        var defer3 = Q.defer();        return defer3.reject(err).nodeify(callback);    }    return this._connect()            .then(function(result){                var client = result.client;                var done = result.done;                var defer = Q.defer();                client.query(sql, params, function(err, result){                    done();                    if(err){                        defer.reject(err);                    }else{                        defer.resolve(result);                    }                });                return defer.promise;            })            .nodeify(callback);};module.exports = DB_Base;